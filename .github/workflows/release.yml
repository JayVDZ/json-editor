name: Create Release

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  release:
    runs-on: ubuntu-latest
    # Only run on main branch
    if: github.ref_type == 'tag' && github.event.base_ref == 'refs/heads/main'

    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create release directory
        run: |
          mkdir -p release
          cp index.html release/
          cp README.md release/
          cp example-schema.json release/
          cp test-data.json release/

      - name: Create release archive
        run: |
          cd release
          zip -r ../json-editor-${{ github.ref_name }}.zip .
          cd ..

      - name: Extract release notes
        id: extract_notes
        run: |
          TAG_NAME=${{ github.ref_name }}
          echo "tag_name=${TAG_NAME}" >> $GITHUB_OUTPUT
          echo "release_name=JSON Editor ${TAG_NAME}" >> $GITHUB_OUTPUT

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: ${{ steps.extract_notes.outputs.release_name }}
          body: |
            ## JSON Editor - ${{ steps.extract_notes.outputs.tag_name }}

            Offline JSON editor with syntax highlighting, real-time validation, and graph visualisation.

            ### Installation
            1. Download `json-editor-${{ github.ref_name }}.zip`
            2. Extract the archive
            3. Open `index.html` in your browser

            ### What's Changed
            See commit history for details.
          files: |
            json-editor-${{ github.ref_name }}.zip
          draft: false
          prerelease: false
